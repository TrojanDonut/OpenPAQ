
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../getting_started/">
      
      
        <link rel="next" href="../usage/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Configuration - OpenPAQ</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        
        <link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.936b8ee8.css">
        <style>:root{--md-text-font:"Roboto Condensed";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="OpenPAQ" class="md-header__button md-logo" aria-label="OpenPAQ" data-md-component="logo">
      
  <img src="../img/openpaq.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OpenPAQ
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuration
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/DENICeG/OpenPAQ" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="OpenPAQ" class="md-nav__button md-logo" aria-label="OpenPAQ" data-md-component="logo">
      
  <img src="../img/openpaq.svg" alt="logo">

    </a>
    OpenPAQ
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/DENICeG/OpenPAQ" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview-of-configurable-components" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of configurable components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Overview Environment variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-clickhouse" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Clickhouse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure Clickhouse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schema-for-german-listmatcher" class="md-nav__link">
    <span class="md-ellipsis">
      Schema for german listmatcher
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-ssltls" class="md-nav__link">
    <span class="md-ellipsis">
      Configure SSL/TLS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure SSL/TLS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Example configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-a-self-signed-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Generating a self-signed certificate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-openpaq-with-tls-enabled" class="md-nav__link">
    <span class="md-ellipsis">
      Run OpenPAQ with TLS enabled
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-an-access-token" class="md-nav__link">
    <span class="md-ellipsis">
      Generating an access token
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-cache" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Cache
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-setup-self-hosted-nominatim" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced setup - self-hosted nominatim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced setup - self-hosted nominatim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../open_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAPI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contribution
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License & EOL
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.denic.de/ueber-denic/impressum" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Imprint
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview-of-configurable-components" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of configurable components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overview-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Overview Environment variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-clickhouse" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Clickhouse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure Clickhouse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#schema-for-german-listmatcher" class="md-nav__link">
    <span class="md-ellipsis">
      Schema for german listmatcher
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Environment Variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-ssltls" class="md-nav__link">
    <span class="md-ellipsis">
      Configure SSL/TLS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure SSL/TLS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Example configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Example configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-a-self-signed-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Generating a self-signed certificate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-openpaq-with-tls-enabled" class="md-nav__link">
    <span class="md-ellipsis">
      Run OpenPAQ with TLS enabled
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-an-access-token" class="md-nav__link">
    <span class="md-ellipsis">
      Generating an access token
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-cache" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Cache
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-setup-self-hosted-nominatim" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced setup - self-hosted nominatim
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced setup - self-hosted nominatim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="configuration">Configuration</h1>
<p>There are mainly two options to get OpenPAQ running. The first option is to compile the code and run the binary directly.</p>
<p>This section will focus on the available docker container.
The container is available <a href="ghcr.io/deniceg/openpaq:latest">here</a>.</p>
<h2 id="overview-of-configurable-components">Overview of configurable components</h2>
<p>There are several optional configuration items available in OpenPAQ. The following diagram provides an overview about 
the available components.
For further details about each component, please have a look to the appropriate section on this page.</p>
<pre class="mermaid"><code>flowchart TD

    subgraph op[openPAQ]
        openPAQ
        subgraph optional
            TLS
            JWT
        end
    end

    subgraph ch [optional]
        Clickhouse
    end

    subgraph mc [optional]
        Memcached
    end

    subgraph nom [optional]
        Nominatim
    end

    op &lt;--&gt; ch
    op &lt;--&gt; nom
    op &lt;--&gt; mc
</code></pre>
<h2 id="overview-environment-variables">Overview Environment variables</h2>
<p>Since OpenPAQ is designed for container environments, all configuration settings are set via environment variables.
An Overview for all available settings are listed in the table below.</p>
<table>
<thead>
<tr>
<th>Variable name</th>
<th>Example Input</th>
<th style="text-align: center;">Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CLICKHOUSE_ENABLED</td>
<td>false</td>
<td style="text-align: center;">x</td>
<td>Enables the loading of street lists from a clickhouse db server (if you want to use only nominatim set it to false)</td>
</tr>
<tr>
<td>CLICKHOUSE_DB_USERNAME</td>
<td>default</td>
<td style="text-align: center;"></td>
<td>User for clickhouse connection</td>
</tr>
<tr>
<td>CLICKHOUSE_DB_PASSWORD</td>
<td>prettypassword</td>
<td style="text-align: center;"></td>
<td>Password for clickhouse connection</td>
</tr>
<tr>
<td>CLICKHOUSE_DB_HOST</td>
<td>clickhouse.server.de</td>
<td style="text-align: center;"></td>
<td>Hostname for clickhouse connection without port</td>
</tr>
<tr>
<td>CLICKHOUSE_DB_PORT</td>
<td>9000</td>
<td style="text-align: center;"></td>
<td>Port for clickhouse connection</td>
</tr>
<tr>
<td>CLICKHOUSE_DB_DATABASE</td>
<td>address</td>
<td style="text-align: center;"></td>
<td>Database in which the street lists are stored</td>
</tr>
<tr>
<td>CLICKHOUSE_DB_TABLE</td>
<td>lists</td>
<td style="text-align: center;"></td>
<td>Table of street list of germany to list matching</td>
</tr>
<tr>
<td>USE_TLS</td>
<td>false</td>
<td style="text-align: center;">x</td>
<td>Enables TLS encryption to use HTTPS instead of HTTP</td>
</tr>
<tr>
<td>TLS_KEY_FILE_PATH</td>
<td>/cert/key.pem</td>
<td style="text-align: center;"></td>
<td>Path to the secret key file</td>
</tr>
<tr>
<td>TLS_CERT_FILE_PATH</td>
<td>/cert/cert.pem</td>
<td style="text-align: center;"></td>
<td>Path to the certificate file</td>
</tr>
<tr>
<td>USE_JWT</td>
<td>true</td>
<td style="text-align: center;">x</td>
<td>To secure the usage of the api it is possible and recommended to use jwt tokens for authorization</td>
</tr>
<tr>
<td>JWT_SIGNING_KEY</td>
<td>a-string-secret-at-least-256-bits-long</td>
<td style="text-align: center;"></td>
<td>Signing Key for jwt</td>
</tr>
<tr>
<td>WEBSERVER_LISTEN_ADDRESS</td>
<td>127.0.0.1:8001</td>
<td style="text-align: center;"></td>
<td>Address OpenPAQ binds on</td>
</tr>
<tr>
<td>NOMINATIM_ADDRESS</td>
<td>https://nominatim.openstreetmap.org/search</td>
<td style="text-align: center;">x</td>
<td>Address</td>
</tr>
<tr>
<td>CACHE_ENABLED</td>
<td>false</td>
<td style="text-align: center;">x</td>
<td>Use memcache</td>
</tr>
<tr>
<td>CACHE_URL</td>
<td>localhost:11211</td>
<td style="text-align: center;"></td>
<td>URL to memcache</td>
</tr>
<tr>
<td>VERSION</td>
<td>5.0.4</td>
<td style="text-align: center;">x</td>
<td>The name of the version is included in the response, useful during development or to distinguish different environments</td>
</tr>
<tr>
<td>LOG_LEVEL</td>
<td>info</td>
<td style="text-align: center;">x</td>
<td>Available log levels are: trace, debug, info, warning, error, fatal, panic</td>
</tr>
</tbody>
</table>
<h2 id="configure-clickhouse">Configure Clickhouse</h2>
<p>If you want to use the list matching mechanism a clickhouse configuration is needed. Information on <a href="https://clickhouse.com/">Clickhouse</a> and how to set up the database can be found on their website. 
A listmatcher for Germany is implemented and can be used out of the box. Create a table
with the schema described below. Afterwards, fill the table with data from a source of your choice (e.g. <a href="https://www.geodaten-deutschland.de/postleitzahlen-strassen-liste-deutschland.php">geodata for Germany</a>).
There are several benefits by using a listmatcher:</p>
<ul>
<li>The results may be more accurate, as the areas and postal code regions in Nominatim are only calculated.</li>
<li>The memory lookup can potentially be faster, depending on your setup.</li>
</ul>
<h3 id="schema-for-german-listmatcher">Schema for german listmatcher</h3>
<p>This is an example query to create a lookup table for a german street list.</p>
<div class="highlight"><pre><span></span><code>CREATE TABLE default.street_list_germany
(
    `id` UInt32,
    `bundesland_name` LowCardinality(String),
    `regierungsbezirk_name` String,
    `kreis_name` String,
    `kreis_typ` LowCardinality(String),
    `gemeinde_name` String,
    `gemeinde_typ` LowCardinality(String),
    `ort_name` String,
    `ort_lat` Float64,
    `ort_lon` Float64,
    `postleitzahl` String,
    `strasse_name` String
)
ENGINE = MergeTree()
ORDER BY (bundesland_name,
 ort_name,
 postleitzahl,
 strasse_name)
SETTINGS index_granularity = 8192;
</code></pre></div>
<h3 id="environment-variables">Environment Variables</h3>
<p>After setting up the database, Clickhouse must be enabled in OpenPAQ by setting following environment variables:</p>
<ul>
<li>CLICKHOUSE_ENABLED=true</li>
<li>CLICKHOUSE_DB_HOST=&lt;clickhouse host url&gt;</li>
<li>CLICKHOUSE_DB_PORT=&lt;clickhouse native port&gt;</li>
<li>CLICKHOUSE_DB_USERNAME=&lt;clickhouse user with read permissions&gt;</li>
<li>CLICKHOUSE_DB_PASSWORD=&lt;clickhouse user password&gt;</li>
<li>CLICKHOUSE_DB_DATABASE=&lt;clickhouse database name&gt;</li>
<li>CLICKHOUSE_DB_TABLE=&lt;clickhouse table name&gt;</li>
</ul>
<h2 id="configure-ssltls">Configure SSL/TLS</h2>
<p>By default, OpenPAQ starts an HTTP server without any encryption. This is completely fine when you run OpenPAQ behind a
reverse proxy which handles the TLS encryption. It is not recommended to run OpenPAQ without any encryption at all.</p>
<p>To enable the HTTPS server of OpenPAQ following environment variables must be set:</p>
<ul>
<li>USE_TLS=true</li>
<li>TLS_KEY_FILE_PATH=&lt;location of the keyfile in the container&gt;</li>
<li>TLS_CERT_FILE_PATH=&lt;location of the certfile in the container&gt;</li>
</ul>
<h3 id="example-configuration">Example configuration</h3>
<h4 id="generating-a-self-signed-certificate">Generating a self-signed certificate</h4>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span><span class="se">\</span>
-newkey<span class="w"> </span>rsa:4096<span class="w"> </span><span class="se">\</span>
-keyout<span class="w"> </span>key.pem<span class="w"> </span><span class="se">\</span>
-out<span class="w"> </span>cert.pem<span class="w"> </span><span class="se">\</span>
-sha256<span class="w"> </span><span class="se">\</span>
-days<span class="w"> </span><span class="m">3650</span><span class="w"> </span><span class="se">\</span>
-nodes<span class="w"> </span><span class="se">\</span>
-subj<span class="w"> </span><span class="s2">&quot;/C=DE/ST=Hessen/L=Frankfurt am Main/O=Denic e.G./OU=DataScience/CN=OpenPAQ&quot;</span>
</code></pre></div>
<h4 id="run-openpaq-with-tls-enabled">Run OpenPAQ with TLS enabled</h4>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CACHE_ENABLED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span>testing<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CLICKHOUSE_ENABLED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">USE_TLS</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">TLS_KEY_FILE_PATH</span><span class="o">=</span>/cert/key.pem<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">TLS_CERT_FILE_PATH</span><span class="o">=</span>/cert/cert.pem<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">USE_JWT</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">NOMINATIM_ADDRESS</span><span class="o">=</span>https://nominatim.openstreetmap.org/search<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>debug<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">WEBSERVER_LISTEN_ADDRESS</span><span class="o">=</span>:8001<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span><span class="m">8001</span>:8001<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>./key.pem:/cert/key.pem<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>./cert.pem:/cert/cert.pem<span class="w"> </span><span class="se">\</span>
ghcr.io/deniceg/openpaq:latest
</code></pre></div>
<h2 id="configure-authentication">Configure Authentication</h2>
<p>In some use cases it is necessary to restrict the access to the API. Therefore, OpenPAQ provides a mechanism to protect
the access with a <a href="https://www.rfc-editor.org/rfc/rfc7519.html">JWT</a>. To use this, following parameters must be set:</p>
<ul>
<li>USE_JWT=true</li>
<li>JWT_SIGNING_KEY=&lt;any string without space, tabs or linebreaks which has at least 32 chars &gt;</li>
</ul>
<h3 id="example">Example</h3>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CACHE_ENABLED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span>testing<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CLICKHOUSE_ENABLED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">USE_TLS</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">USE_JWT</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">JWT_SIGNING_KEY</span><span class="o">=</span>a-string-secret-at-least-256-bits-long<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">NOMINATIM_ADDRESS</span><span class="o">=</span>https://nominatim.openstreetmap.org/search<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>debug<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">WEBSERVER_LISTEN_ADDRESS</span><span class="o">=</span>:8001<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span><span class="m">8001</span>:8001<span class="w"> </span><span class="se">\</span>
ghcr.io/deniceg/openpaq:latest
</code></pre></div>
<p>After setting up the service, it shouldn't be possible to access the API without a valid JWT.</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>http://127.0.0.1:8001/api/v1/check<span class="se">\</span>
?street<span class="o">=</span>Theodor-Stern-Kai<span class="se">\</span>
<span class="p">&amp;</span><span class="nv">postal_code</span><span class="o">=</span><span class="m">60596</span><span class="se">\</span>
<span class="p">&amp;</span><span class="nv">city</span><span class="o">=</span>Frankfurt<span class="se">\</span>
<span class="p">&amp;</span><span class="nv">country_code</span><span class="o">=</span>DE<span class="se">\</span>
<span class="p">&amp;</span><span class="nv">debug_details</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div>
<p>The response should look like this</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;No token provided&quot;</span><span class="p">}</span>
</code></pre></div>
<h3 id="generating-an-access-token">Generating an access token</h3>
<p>There are several ways to generate JWTs. The easiest way is to use <a href="https://jwt.io/">jwt.io</a>.
Although it is not required, it is recommended that you set an expiration date for the token.
Now you just need to provide the generated token as an authorization header like this: </p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTc0NjI2NzUxN30.XqARRZ3xSery6SgLDjjPyR2IP2tldfNxbFI7cKOw1w0&quot;</span><span class="w"> </span><span class="se">\</span>
http://127.0.0.1:8001/api/v1/check<span class="se">\</span>
?street<span class="o">=</span>Theodor-Stern-Kai<span class="se">\</span>
<span class="p">&amp;</span><span class="nv">postal_code</span><span class="o">=</span><span class="m">60596</span><span class="se">\</span>
<span class="p">&amp;</span><span class="nv">city</span><span class="o">=</span>Frankfurt<span class="se">\</span>
<span class="p">&amp;</span><span class="nv">country_code</span><span class="o">=</span>DE<span class="se">\</span>
<span class="p">&amp;</span><span class="nv">debug_details</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div>
<p>With the provided token you should get the expected result. </p>
<h2 id="configure-cache">Configure Cache</h2>
<p>OpenPAQ is prepared to work with memcached. Activate the cache using the environment variables:</p>
<ul>
<li>CACHE_ENABLED = true</li>
<li>CACHE_URL = &lt;your server address&gt;</li>
</ul>
<p><a href="https://memcached.org/">Memcached</a> is a simple object storage with a small footprint.</p>
<p>To start a very simple Memcached service, the following command can be used:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span><span class="se">\</span>
--name<span class="w"> </span>my-memcache<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span><span class="m">11211</span>:11211<span class="w"> </span><span class="se">\</span>
memcached<span class="w"> </span><span class="se">\</span>
memcached<span class="w"> </span>--memory-limit<span class="o">=</span><span class="m">64</span>
</code></pre></div>
<p>When the memcached container is running, you can start OpenPAQ and enjoy the insane speed of the cache.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CACHE_ENABLED</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CACHE_URL</span><span class="o">=</span>localhost:11211<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span>testing<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CLICKHOUSE_ENABLED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">USE_TLS</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">NOMINATIM_ADDRESS</span><span class="o">=</span>https://nominatim.openstreetmap.org/search<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>debug<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">WEBSERVER_LISTEN_ADDRESS</span><span class="o">=</span>:8001<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span><span class="m">8001</span>:8001<span class="w"> </span><span class="se">\</span>
ghcr.io/deniceg/openpaq:latest
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>macOS and Windows docker environments are virtualized, so the hostname localhost does not work as expected.</p>
<p>You may need to use the host IP instead of localhost as cache host.</p>
</div>
<h2 id="advanced-setup-self-hosted-nominatim">Advanced setup - self-hosted nominatim</h2>
<p>The limitation and policy of openstreetmap.org maybe a showstopper for some use cases with a high number of requests and automatically
running agents.</p>
<p>In these situations it may make sense to host your own nominatim server.
OpenPAQ is battle test with the docker container <a href="https://github.com/mediagis/nominatim-docker">mediagis/nominatim</a>.</p>
<h3 id="example-configuration_1">Example configuration</h3>
<p>In this example a small area of Germany is used. Be aware that the import of the whole world takes a lot of time and require
a big amount of resources. See <a href="https://nominatim.org/release-docs/5.1/admin/Installation/#hardware">Nominatim docs</a> for further information.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span><span class="nv">PBF_URL</span><span class="o">=</span>https://download.geofabrik.de/europe/germany/hessen-latest.osm.pbf<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span><span class="nv">REPLICATION_URL</span><span class="o">=</span>https://https://download.geofabrik.de/europe/germany/hessen-updates/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>nominatim<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>mediagis/nominatim:5.1
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>macOS and Windows docker environments are virtualized, so the hostname localhost does not work as expected.</p>
<p>You may need to use the host IP instead of localhost as cache host.</p>
</div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CACHE_ENABLED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span>testing<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">CLICKHOUSE_ENABLED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">USE_TLS</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">NOMINATIM_ADDRESS</span><span class="o">=</span>http://localhost:8080/search<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>debug<span class="w"> </span><span class="se">\</span>
-e<span class="w"> </span><span class="nv">WEBSERVER_LISTEN_ADDRESS</span><span class="o">=</span>:8001<span class="w"> </span><span class="se">\</span>
-p<span class="w"> </span><span class="m">8001</span>:8001<span class="w"> </span><span class="se">\</span>
ghcr.io/deniceg/openpaq:latest
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../getting_started/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Getting Started">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Getting Started
              </div>
            </div>
          </a>
        
        
          
          <a href="../usage/" class="md-footer__link md-footer__link--next" aria-label="Next: Usage">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Usage
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Powered by <a href="https://www.denic.de"> DENIC</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://www.denic.de" target="_blank" rel="noopener" title="DENIC eG" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.4c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.3c2.2 20.4 3.3 41.8 3.3 64m28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64m112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 20.9 58.2 27 94.7m-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6M8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64m186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.7z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.tabs.link", "content.code.annotate", "navigation.footer"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../assets/external/unpkg.com/mermaid@11/dist/mermaid.min.js"></script>
      
    
  </body>
</html>